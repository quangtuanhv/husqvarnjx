jQuery(document).ready(function(e){function t(e){e.hasClass("open")?e.removeClass("open"):e.addClass("open")}function s(){jQuery("");jQuery(".betrs_settings_section .single-row").each(function(e){op_number=e+1,jQuery(this).attr("data-row_id",op_number),jQuery(this).find(".shipping-headline").each(function(){jQuery(this).html(jQuery(this).html().replace(/(\d)+/,op_number))}),jQuery(this).find(".titlewrap input").each(function(){this.name=this.name.replace(/\[\d+\]/,"["+op_number+"]"),0==this.name.search("option_id")&&(this.value=op_number)}),additional_box=jQuery(this).find(".additional-settings"),additional_box.html(additional_box.html().replace(/\[\d+\]/g,"["+op_number+"]")),jQuery(this).find("table.table_rates tbody").children("tr").each(function(e){var t=jQuery(this).find("td:not(:first-child, :last-child)").find("input,textarea,select");t.each(function(){this.name=this.name.replace(/\[\d+\]/,"["+op_number+"]")})})})}function r(t){t.preventDefault();var s=[],n=jQuery(this),o=jQuery(this).closest(".single-row").find(".wp-list-table.table_rates tbody tr th input:checked");if(o.each(function(e,t){var r=jQuery(t).closest("tr").find("input, select, textarea");s.push(r.serialize())}),0==s.length)return void alert(betrs_data.text_no_selection);var a='<div id="betrs-export-table-popup" class="betrs-popup"><div class="be-popup-container add_form"><h2>'+betrs_data.text_exporting+'</h2><p><img src="'+betrs_data.ajax_loader_url+'" alt="loading..." /></div></div>';jQuery("body").append(a),i();var p={action:"betrs_export_table",rowsSelected:s};return e.post(ajaxurl,p,function(e){0==e?(jQuery("#betrs-export-table-popup").find("h2").text(betrs_data.text_error).addClass("betrs_error"),jQuery("#betrs-export-table-popup").find("h2").after("<p>"+betrs_data.text_error_server+"</p>"),jQuery("#betrs-export-table-popup").find("img").parent().remove(),setTimeout(function(){jQuery("#betrs-export-table-popup").remove()},3e3)):(n.attr("href","data:text/csv;base64,"+btoa(e)),jQuery(".betrs_settings_section").off("click","a.betrs_table_export"),n[0].click(),jQuery("#betrs-export-table-popup").remove(),jQuery(".betrs_settings_section").on("click","a.betrs_table_export",r))}),!1}function i(){var e=jQuery(window).height(),t=e-180;jQuery(".be-popup-container").css("max-height",t+"px")}if(void 0!=jQuery("#user_permissions.betrs_settings_section")){var n=jQuery("#user_permissions.betrs_settings_section table tbody tr");switch("everyone"==jQuery("#woocommerce_betrs_shipping_user_limitation").val()&&n.eq(1).css("display","none"),jQuery("#woocommerce_betrs_shipping_user_modification").val()){case"specific-roles":n.eq(3).css("display","none");break;case"specific-users":n.eq(4).css("display","none");break;case"admins":default:n.eq(3).css("display","none"),n.eq(4).css("display","none")}}if(jQuery("#user_permissions.betrs_settings_section").on("change","#woocommerce_betrs_shipping_user_limitation",function(t){t.preventDefault();var s=e(this).val(),r=jQuery("#user_permissions.betrs_settings_section table tbody tr");"everyone"==s?r.eq(1).css("display","none"):r.eq(1).css("display","")}),jQuery("#user_permissions.betrs_settings_section").on("change","#woocommerce_betrs_shipping_user_modification",function(t){t.preventDefault();var s=e(this).val(),r=jQuery("#user_permissions.betrs_settings_section table tbody tr");r.eq(3).css("display","none"),r.eq(4).css("display","none"),"specific-users"==s?r.eq(3).css("display",""):"specific-roles"==s&&r.eq(4).css("display","")}),void 0!=jQuery("#other.betrs_settings_section")){var n=jQuery("#other.betrs_settings_section table tbody"),o=n.find(".per-class-only");"per-class"!=jQuery("#woocommerce_betrs_shipping_condition").val()&&o.each(function(e,t){jQuery(t).closest("tr").css("display","none")})}jQuery("#general.betrs_settings_section").on("change","#woocommerce_betrs_shipping_condition",function(t){t.preventDefault();var s=e(this).val();"per-class"==s?o.each(function(e,t){jQuery(t).closest("tr").css("display","")}):o.each(function(e,t){jQuery(t).closest("tr").css("display","none")})}),jQuery(".betrs_settings_section").on("click","h3",function(s){s.preventDefault(),t(jQuery(this));var r=e(this).next(".betrs_settings_inner");r.slideToggle("fast")}),jQuery(".betrs_settings_section").on("click",".next-link a",function(e){e.preventDefault();var s=jQuery(this).closest(".betrs_settings_inner"),r=jQuery(this).closest(".betrs_settings_section").next(".betrs_settings_section").find(".betrs_settings_inner");t(s.parent().find("h3")),s.slideToggle("fast"),t(r.parent().find("h3")),r.slideToggle("fast")}),jQuery(".betrs_settings_section").on("change",".operand_selector",function(t){t.preventDefault();var s=e(this).val(),r=jQuery(".volumetric_number").next(".description").find("span"),i=r.html();if("multiply"==s)var n=i.replace("/","x");else var n=i.replace("x","/");r.html(n)}),jQuery(".betrs_settings_section").on("click",".betrs-move-option-up",function(e){e.preventDefault();var t=jQuery(this).closest(".single-row"),r=t.prev(".single-row");return 0!==r.length&&(t.insertBefore(r),s()),!1}),jQuery(".betrs_settings_section").on("click",".betrs-move-option-down",function(e){e.preventDefault();var t=jQuery(this).closest(".single-row"),r=t.next(".single-row");return 0!==r.length&&(t.insertAfter(r),s()),!1}),jQuery(".betrs_settings_section").on("click","a.betrs_table_import",function(e){e.preventDefault();var t=jQuery(this).closest(".single-row").find(".wp-list-table.table_rates"),s=jQuery(this).closest(".single-row").attr("data-row_id"),r=t.find("tbody > tr").length;1==r&&t.find("tbody").children("tr:first").hasClass("no-items")&&r--;var n='<div id="betrs-import-table-popup" class="betrs-popup"><div class="be-popup-container add_form" id="betrs-import-table-form"><form method="post" enctype="multipart/form-data"><h3>'+betrs_data.text_importing_table+"</h3><p><span>"+betrs_data.text_importing_csv+'</span></p><input type="hidden" name="option_ID" id="option_ID" value="'+s+'" /><input type="hidden" name="row_ID" id="row_ID" value="'+r+'" /><p><input type="file" name="betrs_import_csv" id="betrs_import_csv" accept=".csv, text/csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" /></p><p><label><input type="checkbox" name="betrs_table_delete" id="betrs_table_delete" />'+betrs_data.text_importing_del+'</label></p><p><input type="submit" name="betrs_table_import" value="'+betrs_data.text_upload+'" class="form_submit" /> <a href="#" class="cancel">'+betrs_data.text_cancel+"</a></p></form></div></div>";jQuery("body").append(n),i()}),jQuery(document).on("submit","#betrs-import-table-form",function(t){t.preventDefault();var s=jQuery(this).find("input#option_ID").val(),r=jQuery(this).find("input#row_ID").val(),i=jQuery("#BETRS-table-rates-parent").find('.single-row[data-row_id="'+s+'"]').find(".wp-list-table.table_rates tbody"),n=jQuery(this).find("input#betrs_table_delete"),o=jQuery(this).find("input#betrs_import_csv"),a=[".csv","text/csv","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel"],p=/(\.csv)$/i;if(o.val()){var c=o[0].files[0],l=jQuery(this);if(a.indexOf(c.type)>-1||p.test(c.name)){l.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var u=new FileReader;u.readAsText(c),u.onload=function(t){n.is(":checked")&&(i.find("tr").remove(),r=0);var o=t.target.result,a={action:"betrs_import_table",csvFile:o,optionID:s,rowID:r};e.post(ajaxurl,a,function(e){if(-1!=e.search("<tr"))i.append(e),void 0!=i.find("tr.no-items")&&i.find("tr.no-items").remove(),jQuery("#betrs-import-table-popup").remove();else{var t=l.find("p span");t.text(betrs_data.text_error),t.css("color","#f44336"),l.find(".blockUI").remove()}})}}else jQuery(this).find('input[type="file"]').parent().css("border","1px solid #f44336")}else jQuery(this).find('input[type="file"]').parent().css("border","1px solid #f44336");return!1}),jQuery(".betrs_settings_section").on("click","a.betrs_table_export",r),jQuery(window).on("resize",function(){i()}),jQuery(document).on("click",".be-popup-container .cancel",function(){return jQuery(".betrs-popup").remove(),!1})});